name: "Document Summarization Pipeline"
description: "Extracts text from documents and generates comprehensive summaries with key insights"
version: "1.0.0"

inputs:
  - name: "document_path"
    type: "string"
    description: "Path to the document file (PDF, DOCX, TXT, MD)"
    required: true
  - name: "summary_length"
    type: "string"
    description: "Length of summary"
    default: "medium"
    options: ["short", "medium", "long"]
  - name: "include_key_points"
    type: "boolean"
    description: "Include bullet points of key insights"
    default: true
  - name: "target_audience"
    type: "string"
    description: "Target audience for the summary"
    default: "general"

outputs:
  - name: "summary"
    type: "string"
    description: "Generated document summary"
  - name: "key_points"
    type: "array"
    description: "List of key insights and takeaways"
  - name: "word_count"
    type: "number"
    description: "Word count of original document"

steps:
  - name: "validate_document"
    type: "validation"
    config:
      rules:
        - field: "document_path"
          type: "file_exists"
        - field: "document_path"
          type: "file_extension"
          allowed: [".pdf", ".docx", ".txt", ".md"]

  - name: "extract_text"
    type: "file_processing"
    config:
      input: "{{ inputs.document_path }}"
      operation: "extract_text"
      preserve_formatting: true

  - name: "analyze_content"
    type: "llm_processing"
    provider: "claude"
    config:
      model: "claude-3-sonnet-20240229"
      prompt: |
        Analyze the following document and provide a comprehensive summary.
        
        Document content:
        {{ steps.extract_text.output }}
        
        Please provide:
        1. A {{ inputs.summary_length }} summary appropriate for {{ inputs.target_audience }} audience
        2. Word count of the original document
        {% if inputs.include_key_points %}
        3. Key points and insights as bullet points
        {% endif %}
        
        Format your response as JSON:
        {
          "summary": "your summary here",
          "word_count": number,
          {% if inputs.include_key_points %}
          "key_points": ["point 1", "point 2", "point 3"]
          {% endif %}
        }
      temperature: 0.3
      max_tokens: 2000

  - name: "parse_results"
    type: "data_processing"
    config:
      input: "{{ steps.analyze_content.output }}"
      operation: "parse_json"

  - name: "format_output"
    type: "transformation"
    config:
      summary: "{{ steps.parse_results.output.summary }}"
      key_points: "{{ steps.parse_results.output.key_points || [] }}"
      word_count: "{{ steps.parse_results.output.word_count }}"

error_handling:
  - condition: "file_not_found"
    action: "return_error"
    message: "Document file not found at specified path"
  - condition: "unsupported_format"
    action: "return_error"
    message: "Document format not supported"
  - condition: "extraction_failed"
    action: "retry"
    max_attempts: 2

metadata:
  category: "content_generation"
  tags: ["summarization", "document_processing", "text_analysis"]
  use_cases: ["research", "content_review", "knowledge_extraction"]